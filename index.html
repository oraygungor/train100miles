<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Paradox: Visual Proof</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563EB;
            margin-top: -8px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #E5E7EB;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center py-12 px-4">

    <!-- Minimal Header -->
    <div class="text-center mb-10">
        <h1 class="text-4xl font-bold text-slate-900 tracking-tight mb-2">The Train Paradox</h1>
        <p class="text-slate-500 text-sm">Condition: <span class="font-semibold text-red-500">Every</span> 1-hour interval covers exactly 100 miles.</p>
    </div>

    <!-- Main Card -->
    <div class="bg-white p-4 rounded-3xl shadow-xl border border-slate-100 max-w-5xl w-full">
        
        <!-- Canvas Wrapper -->
        <div class="relative w-full aspect-[16/9] md:aspect-[21/9] lg:h-[450px]">
            <canvas id="trainChart" class="w-full h-full rounded-2xl"></canvas>
            
            <!-- Minimal Legend (Top Left) -->
            <div class="absolute top-60 right-20 bg-white/90 backdrop-blur text-xs p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col gap-2">
                <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-blue-600"></span> 
                    <span class="font-medium text-slate-600">Actual Path</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span> 
                    <span class="font-medium text-slate-600">
                        Total Avg: <span id="legendAvg" class="font-bold text-red-600 text-sm ml-1">100.0</span> mph
                    </span>
                </div>
            </div>
        </div>

        <!-- Single Control: Speed Variance -->
        <div class="px-8 py-6 border-t border-slate-50 mt-2">
            <div class="flex justify-between items-center mb-4">
                <span class="font-bold text-slate-700">Speed Variance</span>
                <span id="varianceVal" class="font-mono text-lg text-blue-600 font-bold">0%</span>
            </div>
            
            <input type="range" id="varianceSlider" min="-100" max="100" value="0" step="1">
            
            <div class="flex justify-between text-xs text-slate-400 mt-3 font-medium tracking-wide uppercase">
                <span>Constant Speed</span>
                <span>Variable Speed</span>
            </div>
        </div>

    </div>

    <script>
        const canvas = document.getElementById('trainChart');
        const ctx = canvas.getContext('2d');
        const varianceSlider = document.getElementById('varianceSlider');
        const varianceVal = document.getElementById('varianceVal');
        const legendAvg = document.getElementById('legendAvg');

        // Logic Setup
        let sliderValue = 0;
        let scannerT = 0; 
        
        // Resize canvas for crisp rendering
        function resize() {
            canvas.width = canvas.parentElement.offsetWidth * 2;
            canvas.height = canvas.parentElement.offsetHeight * 2;
            ctx.scale(2, 2);
        }
        window.addEventListener('resize', resize);
        resize();

        // Math Constants
        const margin = { top: 40, right: 40, bottom: 40, left: 60 }; 
        const maxTime = 5.5; 
        const maxDist = 600; 

        // Physics Functions
        function getAmplitude() { return sliderValue * 0.98; }

        function getDistance(t) {
            const A = getAmplitude();
            const term = (A / (2 * Math.PI)); 
            return 100 * t + term * (1 - Math.cos(2 * Math.PI * t));
        }

        function getVelocity(t) {
            const A = getAmplitude();
            return 100 + A * Math.sin(2 * Math.PI * t);
        }

        // Draw Loop
        function draw() {
            // Clear
            const w = canvas.width / 2;
            const h = canvas.height / 2;
            ctx.clearRect(0, 0, w, h);

            // Scales
            const scaleX = (t) => margin.left + (t / maxTime) * (w - margin.left - margin.right);
            const scaleY = (d) => h - margin.bottom - (d / maxDist) * (h - margin.top - margin.bottom);

            // 1. Grid
            ctx.strokeStyle = '#F1F5F9';
            ctx.lineWidth = 1;
            ctx.font = '11px Inter';
            ctx.fillStyle = '#94A3B8';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // X Axis
            for (let t = 0; t <= 5; t++) {
                const x = scaleX(t);
                ctx.beginPath(); ctx.moveTo(x, margin.top); ctx.lineTo(x, h - margin.bottom); ctx.stroke();
                ctx.fillText(t + 'h', x, h - margin.bottom + 20);
            }
            // 5.5h Mark
            const xFinal = scaleX(5.5);
            ctx.beginPath(); ctx.moveTo(xFinal, margin.top); ctx.lineTo(xFinal, h - margin.bottom); ctx.stroke();
            ctx.fillText('5.5h', xFinal, h - margin.bottom + 20);

            // Y Axis
            ctx.textAlign = 'right';
            for (let d = 0; d <= maxDist; d += 100) {
                const y = scaleY(d);
                ctx.beginPath(); ctx.moveTo(margin.left, y); ctx.lineTo(w - margin.right, y); ctx.stroke();
                ctx.fillText(d, margin.left - 12, y);
            }

            // 2. Average Speed Line (Red - Dashed)
            const tTotal = 5.5;
            const dTotal = getDistance(tTotal);
            ctx.beginPath();
            ctx.strokeStyle = '#EF4444';
            ctx.lineWidth = 2;
            ctx.setLineDash([6, 6]);
            ctx.moveTo(scaleX(0), scaleY(0));
            ctx.lineTo(scaleX(tTotal), scaleY(dTotal));
            ctx.stroke();
            ctx.setLineDash([]);

            // 2b. End Point Markers (Total Distance)
            const xFinalMark = scaleX(tTotal);
            const yFinalMark = scaleY(dTotal);

            ctx.beginPath();
            ctx.strokeStyle = '#DC2626'; 
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            
            ctx.moveTo(xFinalMark, yFinalMark);
            ctx.lineTo(margin.left, yFinalMark);
            
            ctx.moveTo(xFinalMark, yFinalMark);
            ctx.lineTo(xFinalMark, h - margin.bottom);
            ctx.stroke();
            ctx.setLineDash([]);

            // Red Dot at End
            ctx.beginPath();
            ctx.fillStyle = '#DC2626';
            ctx.arc(xFinalMark, yFinalMark, 4, 0, Math.PI * 2);
            ctx.fill();

            // Total Distance Label ON Y-AXIS
            ctx.save();
            ctx.font = 'bold 12px Inter';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            const text = dTotal.toFixed(1);
            const textWidth = ctx.measureText(text).width;
            
            // Background box
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)'; 
            ctx.shadowColor = 'rgba(0,0,0,0.1)';
            ctx.shadowBlur = 4;
            ctx.fillRect(margin.left - 18 - textWidth, yFinalMark - 10, textWidth + 14, 20);
            
            // Text
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#DC2626'; 
            ctx.fillText(text, margin.left - 12, yFinalMark);
            ctx.restore();

            // 3. Actual Curve (Blue)
            ctx.beginPath();
            ctx.strokeStyle = '#2563EB'; 
            ctx.lineWidth = 3;
            ctx.lineJoin = 'round';
            for (let px = margin.left; px <= w - margin.right; px++) {
                const t = (px - margin.left) / (w - margin.left - margin.right) * maxTime;
                if (t > maxTime) break;
                const d = getDistance(t);
                if (px === margin.left) ctx.moveTo(px, scaleY(d));
                else ctx.lineTo(px, scaleY(d));
            }
            ctx.stroke();

            // 4. Scanner (Green Box)
            const tStart = scannerT;
            const tEnd = scannerT + 1;
            
            if (tEnd <= maxTime + 0.1) {
                const xS = scaleX(tStart);
                const xE = scaleX(tEnd);
                const yS = scaleY(getDistance(tStart));
                const yE = scaleY(getDistance(tEnd)); 

                // Fill Box
                ctx.fillStyle = 'rgba(16, 185, 129, 0.1)'; 
                ctx.strokeStyle = '#10B981'; 
                ctx.lineWidth = 1;
                
                ctx.beginPath();
                ctx.moveTo(xS, yS);
                ctx.lineTo(xE, yS);
                ctx.lineTo(xE, yE);   
                ctx.lineTo(xS, yE); 
                ctx.lineTo(xS, yS); 
                ctx.fill();
                ctx.stroke();

                // Scanner Labels (Delta) inside box
                ctx.fillStyle = '#059669'; // Green text
                ctx.font = 'bold 10px Inter';
                ctx.textAlign = 'left';
                ctx.fillText("Î”d=100", xE + 6, (yS+yE)/2);

                // Train Dot
                ctx.beginPath();
                ctx.fillStyle = '#2563EB';
                ctx.arc(xS, yS, 6, 0, Math.PI*2);
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();

                // --- DYNAMIC LABELS ---
                const v = getVelocity(tStart);
                const centerX = (xS + xE) / 2;

                // A. Instant Velocity (TOP, Blue)
                ctx.save();
                ctx.fillStyle = '#2563EB'; 
                ctx.font = 'bold 13px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`v = ${v.toFixed(0)} mph`, centerX, yE - 12); // yE is top edge visually
                ctx.restore();

                // B. Interval Rule (BOTTOM, Greenish to match box)
                ctx.save();
                ctx.fillStyle = '#059669'; // Green to match box
                ctx.font = 'bold 13px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`1h Rule: 100 mph`, centerX, yS + 20); // yS is bottom edge visually
                ctx.restore();
            }

            // --- UPDATE LEGEND AVG SPEED ---
            const totalAvg = dTotal / tTotal;
            legendAvg.innerText = totalAvg.toFixed(1);
        }

        function loop() {
            scannerT += 0.005;
            if (scannerT > 4.5) scannerT = 0;
            
            draw();
            requestAnimationFrame(loop);
        }

        varianceSlider.addEventListener('input', (e) => {
            sliderValue = parseFloat(e.target.value);
            varianceVal.innerText = Math.abs(sliderValue) + "%";
        });

        loop();

    </script>
</body>
</html>
